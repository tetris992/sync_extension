(()=>{function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},o(e)}function e(o,e){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(o);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),r.push.apply(r,t)}return r}function r(o){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){t(o,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(n,e))}))}return o}function t(e,r,t){return(r=function(e){var r=function(e){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,"string");if("object"!=o(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(r)?r:r+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function n(o,e,t){var n=!1,c=setTimeout((function(){n||(n=!0,console.error("[background] safeSendMessage TIMEOUT:",e.action),t({success:!1,message:"Content script 응답 타임아웃: "+e.action}))}),arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4);chrome.tabs.sendMessage(o,e,(function(o){if(!n){if(n=!0,clearTimeout(c),chrome.runtime.lastError)return console.error("[background] safeSendMessage lastError:",chrome.runtime.lastError.message),void t({success:!1,message:"sendMessage error: "+chrome.runtime.lastError.message});if(!o)return console.error("[background] safeSendMessage got empty resp:",e.action),void t({success:!1,message:"No response from content script: "+e.action});console.log("[background] safeSendMessage success resp:",o),t(r({success:!0},o))}}))}chrome.runtime.onInstalled.addListener((function(){console.log("[background] extension installed")})),chrome.runtime.onMessageExternal.addListener((function(o,e,t){if("SET_TOKEN"===o.action){var c=o.token;return console.log("[background] Received token from React:",c),chrome.storage.local.set({accessToken:c},(function(){console.log("[background] accessToken stored in chrome.storage.local"),t({success:!0})})),!0}if("SET_OTA_TOGGLES"===o.action){var a=o.toggles;return console.log("[background] Received SET_OTA_TOGGLES from React:",a),chrome.storage.local.set({otaToggles:a},(function(){console.log("[background] otaToggles stored in chrome.storage.local"),t({success:!0})})),!0}if("TRIGGER_GOODMOTEL_SCRAPE"===o.action){console.log("[background] Received TRIGGER_GOODMOTEL_SCRAPE:",o);var s=o.hotelId;return chrome.tabs.query({url:"https://ad.goodchoice.kr/*"},(function(o){if(!o.length)return console.error("[background] No active tab found for ad.goodchoice.kr/*"),void t({success:!1,message:"굿모텔(광고센터) 탭이 없거나 로그인 안됨"});var e=o[0];console.log("[background] Found GoodMotel tab:",e.id),n(e.id,{action:"SCRAPE_GOODMOTEL",hotelId:s},t)})),!0}if("TRIGGER_GOODHOTEL_SCRAPE"===o.action){console.log("[background] Received TRIGGER_GOODHOTEL_SCRAPE action",o);var i=o.hotelId;return chrome.tabs.query({},(function(o){console.log("[background] All open tabs:",o.map((function(o){return o.url})))})),chrome.tabs.query({url:"https://partner.goodchoice.kr/*"},(function(o){if(!o.length)return console.error("[background] No active tab found for partner.goodchoice.kr/*"),void t({success:!1,message:"No active tab found"});var e=o[0];console.log("[background] Found GoodHotel tab:",e.id),chrome.tabs.sendMessage(e.id,{action:"SCRAPE_GOOD_HOTEL",hotelId:i},(function(o){chrome.runtime.lastError?(console.error("[background] Error sending message to GoodHotel content script:",chrome.runtime.lastError),t({success:!1,message:chrome.runtime.lastError.message})):(console.log("[background] Response from GoodHotel content script:",o),t(r({success:!0},o)))}))})),!0}if("TRIGGER_AGODA_SCRAPE"===o.action){console.log("[background] TRIGGER_AGODA_SCRAPE:",o);var u=o.hotelId,l=o.siteName,d=o.roomTypes;return chrome.tabs.query({url:"https://ycs.agoda.com/*"},(function(o){if(!o.length)return console.error("[background] No active tab found for ycs.agoda.com/*"),void t({success:!1,message:"아고다(YCS) 탭이 없거나 로그인 안됨"});var e=o[0];console.log("[background] Found Agoda tab:",e.id),n(e.id,{action:"SCRAPE_AGODA",hotelId:u,siteName:l||"Agoda",roomTypes:d||[]},t)})),!0}if("TRIGGER_YANOLJA_SCRAPE"===o.action){console.log("[background] TRIGGER_YANOLJA_SCRAPE:",o);var g=o.hotelId;return chrome.tabs.query({url:"https://partner.yanolja.com/*"},(function(o){if(!o.length)return console.error("[background] No active tab found for partner.yanolja.com/*"),void t({success:!1,message:"야놀자(제휴센터) 탭이 없거나 로그인 안됨"});var e=o[0];console.log("[background] Found Yanolja tab:",e.id),n(e.id,{action:"SCRAPE_YANOLJA",hotelId:g},t)})),!0}if("TRIGGER_BOOKING_SCRAPE"===o.action){console.log("[background] TRIGGER_BOOKING_SCRAPE:",o);var m=o.hotelId,b=o.siteName,f=o.roomTypes;return chrome.tabs.query({url:"https://admin.booking.com/*"},(function(o){if(!o.length)return console.error("[background] No active tab found for admin.booking.com/*"),void t({success:!1,message:"부킹(Booking) 탭이 없거나 로그인 안됨"});var e=o[0];console.log("[background] Found Booking tab:",e.id);var r=new Date,c=r.toISOString().split("T")[0],a=new Date(r.getTime()+2592e6).toISOString().split("T")[0],s="https://admin.booking.com/hotel/hoteladmin/extranet_ng/manage/search_reservations.html?upcoming_reservations=1&source=nav&hotel_id=6876426&lang=ko"+"&date_from=".concat(c)+"&date_to=".concat(a)+"&date_type=arrival";console.log("[background] Updating tab to finalURL:",s),chrome.tabs.update(e.id,{url:s},(function(o){if(chrome.runtime.lastError)return console.error("[background] tabs.update error:",chrome.runtime.lastError),void t({success:!1,message:chrome.runtime.lastError.message});var r=function(o,c,a){o===e.id&&"complete"===c.status&&(console.log("[background] Booking tab fully loaded -> wait 3s"),chrome.tabs.onUpdated.removeListener(r),setTimeout((function(){n(e.id,{action:"SCRAPE_BOOKING",hotelId:m,siteName:b||"Booking",roomTypes:f||[]},t)}),3e3))};chrome.tabs.onUpdated.addListener(r)}))})),!0}if("TRIGGER_EXPEDIA_SCRAPE"===o.action){console.log("[background] TRIGGER_EXPEDIA_SCRAPE:",o);var p=o.hotelId,E=o.siteName;return chrome.tabs.query({url:["https://www.expediapartnercentral.com/*","https://apps.expediapartnercentral.com/*"]},(function(o){if(!o.length)return console.error("[background] No tab found for Expedia domain"),void t({success:!1,message:"익스피디아(Expedia) 탭이 없거나 로그인 안됨"});var e=o[0];console.log("[background] Found Expedia tab:",e.id);var r="https://apps.expediapartnercentral.com/lodging/bookings?htid=".concat("59872761");chrome.tabs.update(e.id,{url:r},(function(){if(chrome.runtime.lastError)return console.error("[background] tabs.update error:",chrome.runtime.lastError),void t({success:!1,message:chrome.runtime.lastError.message});var o=function(r,c,a){r===e.id&&"complete"===c.status&&(chrome.tabs.onUpdated.removeListener(o),setTimeout((function(){console.log("[background] Expedia page loaded => SCRAPE_EXPEDIA"),n(e.id,{action:"SCRAPE_EXPEDIA",hotelId:p,siteName:E},t)}),3e3))};chrome.tabs.onUpdated.addListener(o)}))})),!0}if("TRIGGER_COOLSTAY_SCRAPE"===o.action){console.log("[background] TRIGGER_COOLSTAY_SCRAPE:",o);var h=o.hotelId,O=o.siteName;return chrome.tabs.query({url:"https://pms.coolstay.co.kr/*"},(function(o){if(!o.length)return console.error("[background] No active tab found for pms.coolstay.co.kr/*"),void t({success:!1,message:"쿨스테이(CoolStay) 탭이 없거나 로그인 안됨"});var e=o[0];console.log("[background] Found CoolStay tab:",e.id),n(e.id,{action:"SCRAPE_COOLSTAY",hotelId:h,siteName:O||"CoolStay"},t)})),!0}return!1})),chrome.runtime.onMessage.addListener((function(o,e,r){return"GET_TOKEN"===o.action?(chrome.storage.local.get("accessToken",(function(o){r({accessToken:o.accessToken||""})})),!0):"GET_OTA_TOGGLES"===o.action&&(console.log("[background] GET_OTA_TOGGLES request received"),chrome.storage.local.get(["otaToggles"],(function(o){r({otaToggles:o.otaToggles||{}})})),!0)}))})();
//# sourceMappingURL=background.bundle.js.map