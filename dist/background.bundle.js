(()=>{function e(o){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(o)}function o(e,o){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);o&&(t=t.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,t)}return r}function r(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach((function(o){t(e,o,n[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))}))}return e}function t(o,r,t){return(r=function(o){var r=function(o){if("object"!=e(o)||!o)return o;var r=o[Symbol.toPrimitive];if(void 0!==r){var t=r.call(o,"string");if("object"!=e(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(o);return"symbol"==e(r)?r:r+""}(r))in o?Object.defineProperty(o,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[r]=t,o}function n(e,o,t){var n=!1,a=setTimeout((function(){n||(n=!0,console.error("[background] safeSendMessage TIMEOUT:",o.action),t({success:!1,message:"Content script 응답 타임아웃: "+o.action}))}),arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4);chrome.tabs.sendMessage(e,o,(function(e){if(!n){if(n=!0,clearTimeout(a),chrome.runtime.lastError)return console.error("[background] safeSendMessage lastError:",chrome.runtime.lastError.message),void t({success:!1,message:"sendMessage error: "+chrome.runtime.lastError.message});if(!e)return console.error("[background] safeSendMessage got empty resp:",o.action),void t({success:!1,message:"No response from content script: "+o.action});console.log("[background] safeSendMessage success resp:",e),t(r({success:!0},e))}}))}chrome.runtime.onInstalled.addListener((function(){console.log("[background] extension installed")})),chrome.runtime.onMessageExternal.addListener((function(e,o,t){if("SET_TOKEN"===e.action){var a=e.token;return console.log("[background] Received token from React:",a),chrome.storage.local.set({accessToken:a},(function(){console.log("[background] accessToken stored in chrome.storage.local"),t({success:!0})})),!0}if("SET_OTA_TOGGLES"===e.action){var c=e.toggles;return console.log("[background] Received SET_OTA_TOGGLES from React:",c),chrome.storage.local.set({otaToggles:c},(function(){console.log("[background] otaToggles stored in chrome.storage.local"),t({success:!0})})),!0}if("TRIGGER_GOODMOTEL_SCRAPE"===e.action){console.log("[background] Received TRIGGER_GOODMOTEL_SCRAPE:",e);var s=e.hotelId;return chrome.tabs.query({url:"https://ad.goodchoice.kr/*"},(function(e){if(!e.length)return console.error("[background] No active tab found for ad.goodchoice.kr/*"),void t({success:!1,message:"굿모텔(광고센터) 탭이 없거나 로그인 안됨"});var o=e[0];console.log("[background] Found GoodMotel tab:",o.id),n(o.id,{action:"SCRAPE_GOODMOTEL",hotelId:s},t)})),!0}if("TRIGGER_GOODHOTEL_SCRAPE"===e.action){console.log("[background] Received TRIGGER_GOODHOTEL_SCRAPE action",e);var i=e.hotelId;return chrome.tabs.query({url:"https://partner.goodchoice.kr/*"},(function(e){if(!e.length)return console.error("[background] No active tab found for partner.goodchoice.kr/*"),void t({success:!1,message:"No active tab found"});var o=e[0];console.log("[background] Found GoodHotel tab:",o.id),chrome.tabs.sendMessage(o.id,{action:"SCRAPE_GOOD_HOTEL",hotelId:i},(function(e){chrome.runtime.lastError?(console.error("[background] Error sending message to GoodHotel content script:",chrome.runtime.lastError),t({success:!1,message:chrome.runtime.lastError.message})):(console.log("[background] Response from GoodHotel content script:",e),t(r({success:!0},e)))}))})),!0}if("TRIGGER_AGODA_SCRAPE"===e.action){console.log("[background] TRIGGER_AGODA_SCRAPE:",e);var u=e.hotelId,l=e.siteName,d=e.roomTypes;return chrome.tabs.query({url:"https://ycs.agoda.com/*"},(function(e){if(!e.length)return console.error("[background] No active tab found for ycs.agoda.com/*"),void t({success:!1,message:"아고다(YCS) 탭이 없거나 로그인 안됨"});var o=e[0];console.log("[background] Found Agoda tab:",o.id),n(o.id,{action:"SCRAPE_AGODA",hotelId:u,siteName:l||"Agoda",roomTypes:d||[]},t)})),!0}if("TRIGGER_YANOLJA_SCRAPE"===e.action){console.log("[background] TRIGGER_YANOLJA_SCRAPE:",e);var g=e.hotelId;return chrome.tabs.query({url:"https://partner.yanolja.com/*"},(function(e){if(!e.length)return console.error("[background] No active tab found for partner.yanolja.com/*"),void t({success:!1,message:"야놀자(제휴센터) 탭이 없거나 로그인 안됨"});var o=e[0];console.log("[background] Found Yanolja tab:",o.id),n(o.id,{action:"SCRAPE_YANOLJA",hotelId:g},t)})),!0}if("TRIGGER_BOOKING_SCRAPE"===e.action){console.log("[background] TRIGGER_BOOKING_SCRAPE:",e);var m=e.hotelId,b=e.siteName,f=e.roomTypes;return chrome.tabs.query({url:"https://admin.booking.com/*"},(function(e){if(!e.length)return console.error("[background] No active tab found for admin.booking.com/*"),void t({success:!1,message:"부킹(Booking) 탭이 없거나 로그인 안됨"});var o=e[0];console.log("[background] Found Booking tab:",o.id);var r=new Date,a=r.toISOString().split("T")[0],c=new Date(r.getTime()+2592e6).toISOString().split("T")[0],s="https://admin.booking.com/hotel/hoteladmin/extranet_ng/manage/search_reservations.html?upcoming_reservations=1&source=nav&hotel_id=6876426&lang=ko"+"&date_from=".concat(a)+"&date_to=".concat(c)+"&date_type=arrival";chrome.tabs.update(o.id,{url:s},(function(e){if(chrome.runtime.lastError)return console.error("[background] tabs.update error:",chrome.runtime.lastError),void t({success:!1,message:chrome.runtime.lastError.message});var r=function(e,a,c){e===o.id&&"complete"===a.status&&(console.log("[background] Booking tab fully loaded -> wait 3s"),chrome.tabs.onUpdated.removeListener(r),setTimeout((function(){n(o.id,{action:"SCRAPE_BOOKING",hotelId:m,siteName:b||"Booking",roomTypes:f||[]},t)}),3e3))};chrome.tabs.onUpdated.addListener(r)}))})),!0}if("TRIGGER_EXPEDIA_SCRAPE"===e.action){console.log("[background] TRIGGER_EXPEDIA_SCRAPE:",e);var p=e.hotelId,h=e.siteName;return chrome.tabs.query({url:["https://www.expediapartnercentral.com/*","https://apps.expediapartnercentral.com/*"]},(function(e){if(!e.length)return console.error("[background] No tab found for Expedia domain"),void t({success:!1,message:"익스피디아(Expedia) 탭이 없거나 로그인 안됨"});var o=e[0];console.log("[background] Found Expedia tab:",o.id);var r="https://apps.expediapartnercentral.com/lodging/bookings?htid=".concat("59872761");chrome.tabs.update(o.id,{url:r},(function(){if(chrome.runtime.lastError)return console.error("[background] tabs.update error:",chrome.runtime.lastError),void t({success:!1,message:chrome.runtime.lastError.message});var e=function(r,a,c){r===o.id&&"complete"===a.status&&(chrome.tabs.onUpdated.removeListener(e),setTimeout((function(){console.log("[background] Expedia page loaded => SCRAPE_EXPEDIA"),n(o.id,{action:"SCRAPE_EXPEDIA",hotelId:p,siteName:h},t)}),3e3))};chrome.tabs.onUpdated.addListener(e)}))})),!0}if("TRIGGER_COOLSTAY_SCRAPE"===e.action){console.log("[background] TRIGGER_COOLSTAY_SCRAPE:",e);var E=e.hotelId,v=e.siteName;return chrome.tabs.query({url:"https://pms.coolstay.co.kr/*"},(function(e){if(!e.length)return console.error("[background] No active tab found for pms.coolstay.co.kr/*"),void t({success:!1,message:"쿨스테이 탭이 없거나 로그인 안됨"});var o=e[0];console.log("[background] Found CoolStay tab:",o.id);var r=new Date,a=O(new Date(r.getFullYear(),r.getMonth(),1)),c=O(new Date(r.getFullYear(),r.getMonth()+1,0)),s="https://pms.coolstay.co.kr/motel-biz-pc/reservation?&page=1&searchType=ST602,ST608"+"&searchExtra=".concat(a,"|").concat(c,",")+"&sort=BOOK_DESC&tabState=0&selectSort=0&selectChannelOut=0&selectDateRange=customInput&selectEnterType=0";chrome.tabs.update(o.id,{url:s},(function(){if(chrome.runtime.lastError)return console.error("[background] tabs.update error:",chrome.runtime.lastError),void t({success:!1,message:chrome.runtime.lastError.message});var e=function(r,a,c){r===o.id&&"complete"===a.status&&(chrome.tabs.onUpdated.removeListener(e),setTimeout((function(){n(o.id,{action:"SCRAPE_COOLSTAY",hotelId:E,siteName:v||"CoolStay"},t)}),3e3))};chrome.tabs.onUpdated.addListener(e)}))})),!0}function O(e){var o=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0");return"".concat(o).concat(r).concat(t)}return!1})),chrome.runtime.onMessage.addListener((function(e,o,r){return"GET_TOKEN"===e.action?(chrome.storage.local.get("accessToken",(function(e){r({accessToken:e.accessToken||""})})),!0):"GET_OTA_TOGGLES"===e.action&&(console.log("[background] GET_OTA_TOGGLES request received"),chrome.storage.local.get(["otaToggles"],(function(e){r({otaToggles:e.otaToggles||{}})})),!0)}))})();
//# sourceMappingURL=background.bundle.js.map